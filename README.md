# CVE-2023-47400

Proof of Concept for the CVE-2023-47400

> Authenticated PHP Remote Code Execution via Arbitrary file write on Nagios XI 5.11.0 

---

> [!Note]
> This poc is based on the technical paper of NCC group : https://research.nccgroup.com/2023/12/13/technical-advisory-multiple-vulnerabilities-in-nagios-xi/

This poc follow this process : 

- Upload a valid image named “test.jpg”
- Use the rename feature of Custom Includes to rename the image to “.htaccess” (which has the effect of overwriting the existing `.htaccess` file)
- Rename the file to “test.jpg” again, resulting in there being no `.htaccess` file present
- Upload a file named “exploit.jpg.php” with payload

The exploitation of this vulnerability leads to remote code execution on the nagiosXI host, bypassing file upload filters (via magic bytes and file extensions filters) and php execution prevention (via `.htaccess`).

> [!Warning] 
> This exploit erase the `/includes/components/custom-includes/images/.htaccess` file present on host in order to allow PHP code execution ! 

## Usage

```bash
# create a venv to isolate deps
python3 -m venv .venv
# run pip install before running the exploit
.venv/bin/pip install -r requirements.txt
.venv/bin/python exploit.py
```
